(self.webpackChunknothing=self.webpackChunknothing||[]).push([[453],{453:(e,t,a)=>{"use strict";a.r(t);const n=[],o=(Math.max,Math.min),i=Math.abs,r=e=>(t,a)=>{if(Object.keys(e).concat(Object.keys(t)).sort().join()===Object.keys(a).sort().join())return{...t,...a};throw new Error("TODO")};n.push((()=>{const e=r({width:0,height:0}),t={new:a=>e(t,{...t,...a}),set_w:(a,n)=>e(t,{...a,width:n})},a=t.new({width:10,height:13});console.assert(10===a.width&&13===a.height,"test struct 1");const n=a.set_w(a,30);console.assert(30===n.width&&13===n.height,"test struct 2")}));const s=(e,t)=>{let a,n,i;if(e.width===t.width&&e.height===t.height)i=1,a=e.width,n=e.height;else if(e.width<=t.width&&e.height===t.height)i=1,a=e.width,n=e.height;else if(e.width===t.width&&e.height<=t.height)i=1,a=e.width,n=e.height;else if(e.width<t.width&&e.height<t.height){const r=t.width/e.width,s=t.height/e.height;i=o(r,s),a=e.width*i,n=e.height*i}else if(e.width>t.width&&e.height>t.height){const r=t.width/e.width,s=t.height/e.height;i=o(r,s),a=e.width*i,n=e.height*i}else if(e.width>t.width)i=t.width/e.width,a=t.width,n=e.height*i;else{if(!(e.height>t.height))throw console.error("Image: ",e),console.error("Workspace: ",t),new Error;i=t.height/e.height,n=t.height,a=e.width*i}if(a&&n&&i)return{width:a,height:n,ratio:i};throw console.error("Image: ",e),console.error("Workspace: ",t),new Error};n.push((()=>{const e=()=>Math.random(),t=(e,t)=>i(e/t)-1<1e-7,a=(e,t)=>e/t<0||e/t-1<1e-7;let n=0;for(;n<1e5;){const o={width:e(),height:e()},i={width:e(),height:e()},r=s(o,i);console.assert(r.width>0,{value:[o,i],result:r}),console.assert(r.height>0,{value:[o,i],result:r});const l=a(r.width,i.width),d=a(r.height,i.height);console.assert(l,{value:[o,i],result:r}),console.assert(d,{value:[o,i],result:r});const h=t(r.width,i.width)||t(r.height,i.height);console.assert(h,{value:[o,i],result:r});const g=t(r.width/r.height,o.width/o.height);console.assert(g,{value:[o,i],result:r}),n+=1}}));const l=e=>document.getElementById(e),d=(e,t,a)=>{e.style[t]=a},h=(e,t,a)=>{e[t]=a},g=(e,t)=>{e.innerHTML=t},c=[],m=(_=["Drag","Select","Iter","Dragging"],e=>_.indexOf(e)>-1?e:(e=>{throw new Error(e)})(`trying to set ${e} but not in ${_}`));var _;const w=[],f={width:0,height:0,ratio:0,label:{None:""},image:[],image_width_px:0,image_height_px:0,max_side_mm:200,document_name:"certificate",font:[],font_size_pt:24,name:"Name",surname:"Surname",name_x_from_bottom_left_mm:0,name_y_from_bottom_left_mm:0,surname_x_from_bottom_left_mm:0,surname_y_from_bottom_left_mm:0},u=(r(f),{new:(e,t)=>{const{width:a,height:n,ratio:o}=s(e,t);return{...u,...f,width:a,height:n,ratio:o}},serialize:e=>JSON.stringify(e),from_workspace:()=>{}});w.push((()=>{const e={width:10,height:15},t={width:10,height:20},a=u.new(e,t),n=10===a.width&&15===a.height&&1===a.ratio;console.assert(n,{value:[e,t],result:a})}));let p={height:()=>window.innerHeight,width:()=>window.innerWidth};p={...p,draw:()=>{p.height()>p.width()&&(e=>{const t=l("header");d(t,"backgroundColor","red"),d(t,"height","4vh"),d(t,"fontSize","1.5em"),g(t,"This app should be used on a horizontal screen")})()}};const y={font_family:"playfair",font_size:"12",font_thikness:"12",font_color:"Black",label_interspace:"2em",max_name:4,max_surname:7,modality:m("Drag"),font_open:!1,logged:!1},b=(e,t)=>{y[e]=t},v=()=>y,x=Math.max,k=Math.min,E=(Math.abs,l("label")),L=l("spacing"),D=l("name"),O=l("surname");window.addEventListener("mousemove",(e=>{const t=l("label");if(l("real-workspace"),v().modality===m("Dragging")){let a=("label","workspace",e=>{const t=l("label").getBoundingClientRect(),a=l("workspace").getBoundingClientRect(),n=a.x,o=a.x+a.width-t.width,i=a.y,r=a.y+a.height-t.height;return{x:k(x(e.x,n),o),y:k(x(e.y,i),r)}})({x:e.clientX,y:e.clientY});a=("real-workspace",e=>{const t=l("real-workspace"),{x:a,y:n}=t.getBoundingClientRect();return{x:e.x-a,y:e.y-n}})(a),d(t,"top",a.y+"px"),d(t,"left",a.x+"px")}}));const z=e=>{b("font_family",e),d(E,"font-family",e)},C=e=>{b("font_size",e),d(E,"font-size",e+"px")},T=e=>{b("font_weight",e),d(E,"font-weight",e)},R=e=>{b("label_interspace",e),d(L,"width",e+"em")},I=e=>{b("max_name",e),g(D,"Name"+Array(e-4).fill("_"))};D.addEventListener("keydown",(e=>{const t=D.innerHTML.length===v().max_name+4,a=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!a&&e.preventDefault()}));const M=e=>{b("max_surname",e),g(O,"Surname"+Array(e-7).fill("_"))};O.addEventListener("keydown",(e=>{const t=O.innerHTML.length===v().max_surname+7,a=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!a&&e.preventDefault()}));const S=e=>{b("font_color",e),d(E,"color",e)},F={new:(e,t,a)=>"TODO",get_font_size_browser_px:()=>""===l("label").style.fontSize?32:l("label").style.fontSize,get_font_size_pt:()=>{get_font_size_browser_px()},get_font_family:()=>v().font_family,get_name:()=>l("name").innerHTML,get_surname:()=>l("surname").innerHTML,name_x:()=>l("name").getClientRect()[0].x,name_y:()=>l("surname").getClientRect()[0].y,surname_x:()=>l("surname").getClientRect()[0].x,surname_y:()=>l("surname").getClientRect()[0].y,transform_x:(e,t)=>t.get_x()-e,transform_y:(e,t)=>t.get_height()-(t.get_y()-e),transformed_name_x:()=>F.transform_x(F.name_x()),transformed_name_y:()=>F.transform_y(F.name_y()),transformed_surname_x:()=>F.transform_x(F.surname_x()),transformed_surname_y:()=>F.transform_y(F.surname_y()),get_font_bytes:async()=>{const e=(await fetch("http://localhost:8000/fonts/playfair/playfair.ttf")).body.getReader();let t=[];return await e.then((({done:e,value:a})=>{t=a})),t}},j=l("font"),B=l("setfont-close"),H=l("setfont-control"),A=l("setfont"),N=l("select-font-family"),P=l("select-font-size"),W=l("select-font-weight"),U=l("select-label-interspace"),X=l("select-name-max"),Y=l("select-surname-max"),$=l("select-font-color"),J={dragging:!1,last_global_mod:null,select_font_family:()=>l("select-font-family")},q=()=>{v().font_open?(d(j,"background-color","#887880"),d(A,"display","none"),b("font_open",!1)):(d(j,"background-color","#8A4F7D"),d(A,"display","block"),b("font_open",!0))};B.addEventListener("click",q),window.addEventListener("mousedown",(e=>{const{x:t,y:a,width:n,height:o}=H.getBoundingClientRect(),i=e.clientY,r=e.clientX;r>=t&&r<=t+n&&i>=a&&i<=a+o&&(J.last_global_mod=v().modality,b("modality",m("Select")),d(H,"cursor","grabbing"),J.dragging=!0)})),window.addEventListener("mouseup",(()=>{J.dragging&&J.last_global_mod&&(d(H,"cursor","grab"),b("modality",J.last_global_mod),J.dragging=!1)})),window.addEventListener("mousemove",(e=>{J.dragging&&(d(A,"top",e.clientY),d(A,"left",e.clientX))})),N.addEventListener("input",(e=>{z(e.target.value)})),N.addEventListener("change",(e=>{z(e.target.value)})),P.addEventListener("input",(e=>{C(parseFloat(e.target.value))})),P.addEventListener("change",(e=>{C(parseFloat(e.target.value))})),W.addEventListener("input",(e=>{T(parseFloat(e.target.value))})),W.addEventListener("change",(e=>{T(parseFloat(e.target.value))})),U.addEventListener("input",(e=>{R(parseFloat(e.target.value))})),U.addEventListener("change",(e=>{R(parseFloat(e.target.value))})),X.addEventListener("input",(e=>{I(parseInt(e.target.value))})),X.addEventListener("change",(e=>{I(parseInt(e.target.value))})),Y.addEventListener("input",(e=>{M(parseInt(e.target.value))})),Y.addEventListener("change",(e=>{M(parseInt(e.target.value))})),$.addEventListener("input",(e=>{S(e.target.value)})),$.addEventListener("change",(e=>{S(e.target.value)}));const G=l("real-workspace");window.addEventListener("mousedown",(e=>{v().modality===m("Drag")&&(d(G,"cursor","grabbing"),b("modality",m("Dragging")))})),window.addEventListener("mouseup",(e=>{v().modality===m("Dragging")&&(d(G,"cursor","grab"),b("modality",m("Drag")))}));const K={new:(e,t)=>"TODO",get_image_coords:(e,t)=>"TODO",get_label_coords:(e,t)=>"TODO",get_src:()=>l("image").src,get_real_image_width_browser_px:()=>l("image").realWidth,get_real_image_height_browser_px:()=>l("image").realHeight,get_resized_image_width_browser_px:()=>l("image").width,get_resized_image_height_browser_px:()=>l("image").height,get_image_bytes:async()=>{const e=K.get_src(),t=(await fetch(e)).body.getReader();let a=[];return await t.then((({done:e,value:t})=>{a=t})),a},get_height:()=>l("real-workspace").height,get_x:()=>l("real-workspace").getClientRect()[0].x,get_y:()=>l("real-workspace").getClientRect()[0].y,get_template:async()=>({image:await K.get_image_bytes(),image_width_px:get_real_image_width_browser_px(),image_height_px:get_real_image_height_browser_px(),max_side_mm:200,document_name:"Ticket",font:await F.get_font_bytes(),font_size_pt:F.get_font_size_pt(),name:F.get_name(),surname:F.get_surname(),name_x_from_bottom_left_mm:F.transformed_name_x(),name_y_from_bottom_left_mm:F.transformed_name_y(),surname_x_from_bottom_left_mm:F.transformed_surname_x(),surname_y_from_bottom_left_mm:F.transformed_surname_y()})},Q=l("dragdrop"),V=l("select"),Z=l("font"),ee=l("iterator"),te=l("load"),ae=l("try"),ne=l("save"),oe=l("name"),ie=l("surname"),re=l("real-workspace"),se=l("upload");te.addEventListener("click",(()=>se.click()));const le=e=>()=>{for(const t of e)d(t,"background-color","#887880")},de=le([Q,V,ee,te,ne]);Q.addEventListener("click",(()=>{de(),d(Q,"background-color","#8A4F7D"),d(re,"cursor","grab"),b("modality",m("Drag")),v().font_open&&q()}));const he=()=>{d(V,"background-color","#8A4F7D"),d(re,"cursor","text"),h(oe,"contentEditable","true"),h(ie,"contentEditable","true"),b("modality",m("Select"))};V.addEventListener("click",(()=>{de(),he()})),Z.addEventListener("click",(()=>{console.log(v().modality,m("Drag")),v().modality===m("Drag")&&(le([Q])(),he()),q()})),ae.addEventListener("click",(async()=>{console.log("try");const e=await K.get_template();console.log(e.length);const t=pfd.Template.new(e).build().get(),a=new Blob([t],{type:"application/pdf"}),n=document.createElement("a");n.download="demo.pdf",n.href=URL.createObjectURL(a),n.click()}));const ge=l("upload"),ce=l("image"),me=l("message"),_e=l("load-image"),we=l("use-test-image"),fe=l("label"),ue=l("loading"),pe=async e=>{let t=await fetch("/upload-photo",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain"},redirect:"follow",referrefPolicy:"no-referree",body:e});const a=await t.text();return[t.status,a]},ye=async(e,t)=>{const a=document.createElement("canvas"),n=a.getContext("2d"),o=new FileReader,i=new Promise((i=>{o.addEventListener("load",(e=>{const o=new Image;o.onload=()=>{a.width=o.width,a.height=o.height,n.drawImage(o,0,0),a.toBlob((e=>i(e)),"image/jpeg",t)},o.src=e.target.result})),o.readAsDataURL(e)}));return await i},be=e=>{h(ce,"src",`/photo-archive/${e}.jpeg`),d(ue,"display","none"),d(ce,"display","block"),d(fe,"display","flex")};ge.addEventListener("change",(async()=>{const e=ge.files;d(me,"display","none"),d(_e,"display","none"),d(we,"display","none"),d(ue,"display","block");for(const t of e){let[e,a]=await pe(await ye(t,.45));e&&a&&be(a)}})),_e.addEventListener("click",(()=>load.click())),we.addEventListener("click",(()=>(d(me,"display","none"),d(_e,"display","none"),d(we,"display","none"),d(ue,"display","block"),void be("test-image"))));const ve=l("password"),xe=l("password-button"),ke=l("login-background");if(xe.addEventListener("click",(()=>{(async e=>{let[t,a]=await(async e=>{let t=await fetch("/login",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",referrefPolicy:"no-referree",body:JSON.stringify({password:e})});const a=await t.text();return[t.status,a]})(e);202==t&&a&&(b("logged",!0),d(ke,"display","none"))})(ve.value)})),"localhost"===location.hostname||"127.0.0.1"===location.hostname){const e=c.concat(n).concat(w);for(const t of e)t()}p.draw(),window.addEventListener("resize",p.draw)}}]);
(self.webpackChunknothing=self.webpackChunknothing||[]).push([[453],{453:(e,t,n)=>{"use strict";n.r(t);const a=[],o=(Math.max,Math.min),i=Math.abs,r=e=>(t,n)=>{if(Object.keys(e).concat(Object.keys(t)).sort().join()===Object.keys(n).sort().join())return{...t,...n};throw new Error("TODO")};a.push((()=>{const e=r({width:0,height:0}),t={new:n=>e(t,{...t,...n}),set_w:(n,a)=>e(t,{...n,width:a})},n=t.new({width:10,height:13});console.assert(10===n.width&&13===n.height,"test struct 1");const a=n.set_w(n,30);console.assert(30===a.width&&13===a.height,"test struct 2")}));const s=(e,t)=>{let n,a,i;if(e.width===t.width&&e.height===t.height)i=1,n=e.width,a=e.height;else if(e.width<=t.width&&e.height===t.height)i=1,n=e.width,a=e.height;else if(e.width===t.width&&e.height<=t.height)i=1,n=e.width,a=e.height;else if(e.width<t.width&&e.height<t.height){const r=t.width/e.width,s=t.height/e.height;i=o(r,s),n=e.width*i,a=e.height*i}else if(e.width>t.width&&e.height>t.height){const r=t.width/e.width,s=t.height/e.height;i=o(r,s),n=e.width*i,a=e.height*i}else if(e.width>t.width)i=t.width/e.width,n=t.width,a=e.height*i;else{if(!(e.height>t.height))throw console.error("Image: ",e),console.error("Workspace: ",t),new Error;i=t.height/e.height,a=t.height,n=e.width*i}if(n&&a&&i)return{width:n,height:a,ratio:i};throw console.error("Image: ",e),console.error("Workspace: ",t),new Error};a.push((()=>{const e=()=>Math.random(),t=(e,t)=>i(e/t)-1<1e-7,n=(e,t)=>e/t<0||e/t-1<1e-7;let a=0;for(;a<1e5;){const o={width:e(),height:e()},i={width:e(),height:e()},r=s(o,i);console.assert(r.width>0,{value:[o,i],result:r}),console.assert(r.height>0,{value:[o,i],result:r});const l=n(r.width,i.width),d=n(r.height,i.height);console.assert(l,{value:[o,i],result:r}),console.assert(d,{value:[o,i],result:r});const h=t(r.width,i.width)||t(r.height,i.height);console.assert(h,{value:[o,i],result:r});const c=t(r.width/r.height,o.width/o.height);console.assert(c,{value:[o,i],result:r}),a+=1}}));const l=e=>document.getElementById(e),d=(e,t,n)=>{e.style[t]=n},h=(e,t,n)=>{e[t]=n},c=(e,t)=>{e.innerHTML=t},g=[],w=(m=["Drag","Select","Iter","Dragging"],e=>m.indexOf(e)>-1?e:(e=>{throw new Error(e)})(`trying to set ${e} but not in ${m}`));var m;const u=[],f={width:0,height:0,ratio:0,label:{None:""},image:[],image_width_px:0,image_height_px:0,max_side_mm:200,document_name:"certificate",font:[],font_size_pt:24,name:"Name",surname:"Surname",name_x_from_bottom_left_mm:0,name_y_from_bottom_left_mm:0,surname_x_from_bottom_left_mm:0,surname_y_from_bottom_left_mm:0},p=(r(f),{new:(e,t)=>{const{width:n,height:a,ratio:o}=s(e,t);return{...p,...f,width:n,height:a,ratio:o}},serialize:e=>JSON.stringify(e),from_workspace:()=>{}});u.push((()=>{const e={width:10,height:15},t={width:10,height:20},n=p.new(e,t),a=10===n.width&&15===n.height&&1===n.ratio;console.assert(a,{value:[e,t],result:n})}));let y={height:()=>window.innerHeight,width:()=>window.innerWidth};y={...y,draw:()=>{y.height()>y.width()&&(e=>{const t=l("header");d(t,"backgroundColor","red"),d(t,"height","4vh"),d(t,"fontSize","1.5em"),c(t,"This app should be used on a horizontal screen")})()}};const v={font_family:"playfair",font_size:"12",font_thikness:"12",font_color:"Black",label_interspace:"2em",max_name:4,max_surname:7,modality:w("Drag"),font_open:!1,logged:!1},_=(e,t)=>{v[e]=t},b=()=>v,k=Math.max,E=Math.min,x=(Math.abs,l("label")),L=l("spacing"),D=l("name"),C=l("surname");window.addEventListener("mousemove",(e=>{const t=l("label");if(l("real-workspace"),b().modality===w("Dragging")){let n=("label","workspace",e=>{const t=l("label").getBoundingClientRect(),n=l("workspace").getBoundingClientRect(),a=n.x,o=n.x+n.width-t.width,i=n.y,r=n.y+n.height-t.height;return{x:E(k(e.x,a),o),y:E(k(e.y,i),r)}})({x:e.clientX,y:e.clientY});n=("real-workspace",e=>{const t=l("real-workspace"),{x:n,y:a}=t.getBoundingClientRect();return{x:e.x-n,y:e.y-a}})(n),d(t,"top",n.y+"px"),d(t,"left",n.x+"px")}}));const I=e=>{_("font_family",e),d(x,"font-family",e)},O=e=>{_("font_size",e),d(x,"font-size",e+"px")},F=e=>{_("font_weight",e),d(x,"font-weight",e)},M=e=>{_("label_interspace",e),d(L,"width",e+"em")},S=e=>{_("max_name",e),c(D,"Name"+Array(e-4).fill("_"))};D.addEventListener("keydown",(e=>{const t=D.innerHTML.length===b().max_name,n=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!n&&e.preventDefault()}));const z=e=>{_("max_surname",e),c(C,"Surname"+Array(e-7).fill("_"))};C.addEventListener("keydown",(e=>{const t=C.innerHTML.length===b().max_surname,n=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!n&&e.preventDefault()}));const T=e=>{_("font_color",e),d(x,"color",e)},j=l("font"),B=l("setfont-close"),A=l("setfont-control"),R=l("setfont"),N=l("select-font-family"),P=l("select-font-size"),H=l("select-font-weight"),W=l("select-label-interspace"),X=l("select-name-max"),Y=l("select-surname-max"),$=l("select-font-color"),J={dragging:!1,last_global_mod:null,select_font_family:()=>l("select-font-family")},U=()=>{b().font_open?(d(j,"background-color","#887880"),d(R,"display","none"),_("font_open",!1)):(d(j,"background-color","#8A4F7D"),d(R,"display","block"),_("font_open",!0))};B.addEventListener("click",U),window.addEventListener("mousedown",(e=>{const{x:t,y:n,width:a,height:o}=A.getBoundingClientRect(),i=e.clientY,r=e.clientX;r>=t&&r<=t+a&&i>=n&&i<=n+o&&(J.last_global_mod=b().modality,_("modality",w("Select")),d(A,"cursor","grabbing"),J.dragging=!0)})),window.addEventListener("mouseup",(()=>{J.dragging&&J.last_global_mod&&(d(A,"cursor","grab"),_("modality",J.last_global_mod),J.dragging=!1)})),window.addEventListener("mousemove",(e=>{J.dragging&&(d(R,"top",e.clientY),d(R,"left",e.clientX))})),N.addEventListener("input",(e=>{I(e.target.value)})),N.addEventListener("change",(e=>{I(e.target.value)})),P.addEventListener("input",(e=>{O(parseFloat(e.target.value))})),P.addEventListener("change",(e=>{O(parseFloat(e.target.value))})),H.addEventListener("input",(e=>{F(parseFloat(e.target.value))})),H.addEventListener("change",(e=>{F(parseFloat(e.target.value))})),W.addEventListener("input",(e=>{M(parseFloat(e.target.value))})),W.addEventListener("change",(e=>{M(parseFloat(e.target.value))})),X.addEventListener("input",(e=>{S(parseInt(e.target.value))})),X.addEventListener("change",(e=>{S(parseInt(e.target.value))})),Y.addEventListener("input",(e=>{z(parseInt(e.target.value))})),Y.addEventListener("change",(e=>{z(parseInt(e.target.value))})),$.addEventListener("input",(e=>{T(e.target.value)})),$.addEventListener("change",(e=>{T(e.target.value)}));const q=l("dragdrop"),G=l("select"),K=l("font"),Q=l("iterator"),V=l("load"),Z=(l("try"),l("save")),ee=l("name"),te=l("surname"),ne=l("real-workspace"),ae=l("upload");V.addEventListener("click",(()=>ae.click()));const oe=e=>()=>{for(const t of e)d(t,"background-color","#887880")},ie=oe([q,G,Q,V,Z]);q.addEventListener("click",(()=>{ie(),d(q,"background-color","#8A4F7D"),d(ne,"cursor","grab"),_("modality",w("Drag")),b().font_open&&U()}));const re=()=>{d(G,"background-color","#8A4F7D"),d(ne,"cursor","text"),h(ee,"contentEditable","true"),h(te,"contentEditable","true"),_("modality",w("Select"))};G.addEventListener("click",(()=>{ie(),re()})),K.addEventListener("click",(()=>{console.log(b().modality,w("Drag")),b().modality===w("Drag")&&(oe([q])(),re()),U()}));const se=l("real-workspace");window.addEventListener("mousedown",(e=>{b().modality===w("Drag")&&(d(se,"cursor","grabbing"),_("modality",w("Dragging")))})),window.addEventListener("mouseup",(e=>{b().modality===w("Dragging")&&(d(se,"cursor","grab"),_("modality",w("Drag")))}));const le=l("upload"),de=l("image"),he=l("message"),ce=l("load-image"),ge=l("use-test-image"),we=l("label"),me=l("loading"),ue=async e=>{let t=await fetch("/upload-photo",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain"},redirect:"follow",referrefPolicy:"no-referree",body:e});const n=await t.text();return[t.status,n]},fe=async(e,t)=>{const n=document.createElement("canvas"),a=n.getContext("2d"),o=new FileReader,i=new Promise((i=>{o.addEventListener("load",(e=>{const o=new Image;o.onload=()=>{n.width=o.width,n.height=o.height,a.drawImage(o,0,0),n.toBlob((e=>i(e)),"image/jpeg",t)},o.src=e.target.result})),o.readAsDataURL(e)}));return await i},pe=e=>{h(de,"src",`/photo-archive/${e}.jpeg`),d(me,"display","none"),d(de,"display","block"),d(we,"display","flex")};le.addEventListener("change",(async()=>{const e=le.files;d(he,"display","none"),d(ce,"display","none"),d(ge,"display","none"),d(me,"display","block");for(const t of e){let[e,n]=await ue(await fe(t,.45));e&&n&&pe(n)}})),ce.addEventListener("click",(()=>load.click())),ge.addEventListener("click",(()=>(d(he,"display","none"),d(ce,"display","none"),d(ge,"display","none"),d(me,"display","block"),void pe("test-image"))));const ye=l("password"),ve=l("password-button"),_e=l("login-background");if(ve.addEventListener("click",(()=>{(async e=>{let[t,n]=await(async e=>{let t=await fetch("/login",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",referrefPolicy:"no-referree",body:JSON.stringify({password:e})});const n=await t.text();return[t.status,n]})(e);202==t&&n&&(_("logged",!0),d(_e,"display","none"))})(ye.value)})),"localhost"===location.hostname||"127.0.0.1"===location.hostname){const e=g.concat(a).concat(u);for(const t of e)t()}y.draw(),window.addEventListener("resize",y.draw)}}]);
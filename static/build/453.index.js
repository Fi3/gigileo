(self.webpackChunknothing=self.webpackChunknothing||[]).push([[453],{453:(e,t,n)=>{"use strict";n.r(t);const r=[],a=(Math.max,Math.min),o=Math.abs,i=e=>(t,n)=>{if(Object.keys(e).concat(Object.keys(t)).sort().join()===Object.keys(n).sort().join())return{...t,...n};throw new Error("TODO")};r.push((()=>{const e=i({width:0,height:0}),t={new:n=>e(t,{...t,...n}),set_w:(n,r)=>e(t,{...n,width:r})},n=t.new({width:10,height:13});console.assert(10===n.width&&13===n.height,"test struct 1");const r=n.set_w(n,30);console.assert(30===r.width&&13===r.height,"test struct 2")}));const s=(e,t)=>{let n,r,o;if(e.width===t.width&&e.height===t.height)o=1,n=e.width,r=e.height;else if(e.width<=t.width&&e.height===t.height)o=1,n=e.width,r=e.height;else if(e.width===t.width&&e.height<=t.height)o=1,n=e.width,r=e.height;else if(e.width<t.width&&e.height<t.height){const i=t.width/e.width,s=t.height/e.height;o=a(i,s),n=e.width*o,r=e.height*o}else if(e.width>t.width&&e.height>t.height){const i=t.width/e.width,s=t.height/e.height;o=a(i,s),n=e.width*o,r=e.height*o}else if(e.width>t.width)o=t.width/e.width,n=t.width,r=e.height*o;else{if(!(e.height>t.height))throw console.error("Image: ",e),console.error("Workspace: ",t),new Error;o=t.height/e.height,r=t.height,n=e.width*o}if(n&&r&&o)return{width:n,height:r,ratio:o};throw console.error("Image: ",e),console.error("Workspace: ",t),new Error};r.push((()=>{const e=()=>Math.random(),t=(e,t)=>o(e/t)-1<1e-7,n=(e,t)=>e/t<0||e/t-1<1e-7;let r=0;for(;r<1e5;){const a={width:e(),height:e()},o={width:e(),height:e()},i=s(a,o);console.assert(i.width>0,{value:[a,o],result:i}),console.assert(i.height>0,{value:[a,o],result:i});const l=n(i.width,o.width),c=n(i.height,o.height);console.assert(l,{value:[a,o],result:i}),console.assert(c,{value:[a,o],result:i});const d=t(i.width,o.width)||t(i.height,o.height);console.assert(d,{value:[a,o],result:i});const g=t(i.width/i.height,a.width/a.height);console.assert(g,{value:[a,o],result:i}),r+=1}}));const l=e=>document.getElementById(e),c=(e,t,n)=>{e.style[t]=n},d=(e,t,n)=>{e[t]=n},g=(e,t)=>{e.innerHTML=t},_=async e=>{const t=(await fetch(e)).body.getReader();return await(async e=>{let t=[],n=!0;for(;n;)await e.read().then((({done:e,value:r})=>{e&&(n=!1),r&&(t=Uint8Array.from([...t,...r]))}));return t})(t)},h=[],m=(u=["Drag","Select","Iter","Dragging"],e=>u.indexOf(e)>-1?e:(e=>{throw new Error(e)})(`trying to set ${e} but not in ${u}`));var u;const f=[],w={width:0,height:0,ratio:0,label:{None:""},image:[],image_width_px:0,image_height_px:0,max_side_mm:200,document_name:"certificate",font:[],font_size_pt:24,name:"Name",surname:"Surname",name_x_from_bottom_left_mm:0,name_y_from_bottom_left_mm:0,surname_x_from_bottom_left_mm:0,surname_y_from_bottom_left_mm:0},p=(i(w),{new:(e,t)=>{const{width:n,height:r,ratio:a}=s(e,t);return{...p,...w,width:n,height:r,ratio:a}},serialize:e=>JSON.stringify(e),from_workspace:()=>{}});f.push((()=>{const e={width:10,height:15},t={width:10,height:20},n=p.new(e,t),r=10===n.width&&15===n.height&&1===n.ratio;console.assert(r,{value:[e,t],result:n})}));let y={height:()=>window.innerHeight,width:()=>window.innerWidth};y={...y,draw:()=>{y.height()>y.width()&&(e=>{const t=l("header");c(t,"backgroundColor","red"),c(t,"height","4vh"),c(t,"fontSize","1.5em"),g(t,"This app should be used on a horizontal screen")})()}};const b={font_family:"playfair",font_size:"12",font_thikness:"12",font_color:"Black",label_interspace:"2em",max_name:4,max_surname:7,modality:m("Drag"),font_open:!1,logged:!1,is_test_image:!1},x=(e,t)=>{b[e]=t},v=()=>b,k=l("real-workspace");window.addEventListener("mousedown",(e=>{v().modality===m("Drag")&&(c(k,"cursor","grabbing"),x("modality",m("Dragging")))})),window.addEventListener("mouseup",(e=>{v().modality===m("Dragging")&&(c(k,"cursor","grab"),x("modality",m("Drag")))}));const E={new:(e,t)=>"TODO",get_image_coords:(e,t)=>"TODO",get_label_coords:(e,t)=>"TODO",get_src:()=>l("image").src,get_real_image_width_px:()=>l("image").naturalWidth,get_real_image_height_px:()=>l("image").naturalHeight,get_resized_image_width_browser_px:()=>l("image").width,get_resized_image_height_browser_px:()=>l("image").height,get_image_bytes:async()=>await _(E.get_src()),get_height:()=>l("real-workspace").getBoundingClientRect().height,get_x:()=>l("real-workspace").getBoundingClientRect().x,get_y:()=>l("real-workspace").getBoundingClientRect().y,get_template:async()=>({image:await E.get_image_bytes(),image_width_px:E.get_real_image_width_px(),image_height_px:E.get_real_image_height_px(),image_width_browser:E.get_resized_image_width_browser_px(),image_height_browser:E.get_resized_image_height_browser_px(),max_side_mm:200,document_name:"Ticket",font:await F.get_font_bytes(),font_size_pt:F.get_font_size_pt(),name:F.get_name(),surname:F.get_surname(),name_x_from_bottom_left_browser:F.transformed_name_x(),name_y_from_bottom_left_browser:F.transformed_name_y(),surname_x_from_bottom_left_browser:F.transformed_surname_x(),surname_y_from_bottom_left_browser:F.transformed_surname_y()}),fetch_template:async()=>{const e=v().is_test_image?"photo-archive/test-image.jpeg":"photo-archive/photo.jpeg",t=await(await fetch("template.json")).json(),n=await _(e);return{...t,font:await _("fonts/examplefont.ttf"),image:n,name:"Name",surname:"Surname"}},transform_template:e=>[e.image,e.image_width_px,e.image_height_px,e.image_width_browser,e.image_height_browser,e.max_side_mm,e.document_name,e.font,BigInt(e.font_size_pt),e.name,e.surname,e.name_x_from_bottom_left_browser,e.name_y_from_bottom_left_browser,e.surname_x_from_bottom_left_browser,e.surname_y_from_bottom_left_browser]},L=Math.max,O=Math.min,D=(Math.abs,l("label")),C=l("spacing"),T=l("name"),S=l("surname");window.addEventListener("mousemove",(e=>{const t=l("label");if(l("real-workspace"),v().modality===m("Dragging")){let n=("label","workspace",e=>{const t=l("label").getBoundingClientRect(),n=l("workspace").getBoundingClientRect(),r=n.x,a=n.x+n.width-t.width,o=n.y,i=n.y+n.height-t.height;return{x:O(L(e.x,r),a),y:O(L(e.y,o),i)}})({x:e.clientX,y:e.clientY});n=("real-workspace",e=>{const t=l("real-workspace"),{x:n,y:r}=t.getBoundingClientRect();return{x:e.x-n,y:e.y-r}})(n),c(t,"top",n.y+"px"),c(t,"left",n.x+"px")}}));const z=e=>{x("font_family",e),c(D,"font-family",e)},B=e=>{x("font_size",e),c(D,"font-size",e+"px")},j=e=>{x("font_weight",e),c(D,"font-weight",e)},R=e=>{x("label_interspace",e),c(C,"width",e+"em")},I=e=>{x("max_name",e),g(T,"Name"+Array(e-4).fill("_"))};T.addEventListener("keydown",(e=>{const t=T.innerHTML.length===v().max_name+4,n=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!n&&e.preventDefault()}));const M=e=>{x("max_surname",e),g(S,"Surname"+Array(e-7).fill("_"))};S.addEventListener("keydown",(e=>{const t=S.innerHTML.length===v().max_surname+7,n=[37,38,39,40,8].indexOf(parseInt(e.keyCode))>-1;t&&!n&&e.preventDefault()}));const A=e=>{x("font_color",e),c(D,"color",e)},F={new:(e,t,n)=>"TODO",get_font_size_browser_px:()=>""===l("label").style.fontSize?32:l("label").style.fontSize,get_font_size_pt:()=>.75*F.get_font_size_browser_px(),get_font_family:()=>v().font_family,get_name:()=>l("name").innerHTML,get_surname:()=>l("surname").innerHTML,name_x:()=>l("name").getBoundingClientRect().x,name_y:()=>l("name").getBoundingClientRect().y,surname_x:()=>l("surname").getBoundingClientRect().x,surname_y:()=>l("surname").getBoundingClientRect().y,transform_x:e=>e-l("image").getBoundingClientRect().x,transform_y:e=>{let t=l("image").getBoundingClientRect().y;return l("image").height-(e-t)-l("label").getBoundingClientRect().height/1.5},transformed_name_x:()=>F.transform_x(F.name_x()),transformed_name_y:()=>F.transform_y(F.name_y()),transformed_surname_x:()=>F.transform_x(F.surname_x()),transformed_surname_y:()=>F.transform_y(F.surname_y()),get_font_bytes:async()=>await _("/fonts/examplefont.ttf")},H=l("font"),$=l("setfont-close"),N=l("setfont-control"),Y=l("setfont"),P=l("select-font-family"),U=l("select-font-size"),W=l("select-font-weight"),J=l("select-label-interspace"),X=l("select-name-max"),q=l("select-surname-max"),K=l("select-font-color"),G={dragging:!1,last_global_mod:null,select_font_family:()=>l("select-font-family")},Q=()=>{v().font_open?(c(H,"background-color","#887880"),c(Y,"display","none"),x("font_open",!1)):(c(H,"background-color","#8A4F7D"),c(Y,"display","block"),x("font_open",!0))};$.addEventListener("click",Q),window.addEventListener("mousedown",(e=>{const{x:t,y:n,width:r,height:a}=N.getBoundingClientRect(),o=e.clientY,i=e.clientX;i>=t&&i<=t+r&&o>=n&&o<=n+a&&(G.last_global_mod=v().modality,x("modality",m("Select")),c(N,"cursor","grabbing"),G.dragging=!0)})),window.addEventListener("mouseup",(()=>{G.dragging&&G.last_global_mod&&(c(N,"cursor","grab"),x("modality",G.last_global_mod),G.dragging=!1)})),window.addEventListener("mousemove",(e=>{G.dragging&&(c(Y,"top",e.clientY),c(Y,"left",e.clientX))})),P.addEventListener("input",(e=>{z(e.target.value)})),P.addEventListener("change",(e=>{z(e.target.value)})),U.addEventListener("input",(e=>{B(parseFloat(e.target.value))})),U.addEventListener("change",(e=>{B(parseFloat(e.target.value))})),W.addEventListener("input",(e=>{j(parseFloat(e.target.value))})),W.addEventListener("change",(e=>{j(parseFloat(e.target.value))})),J.addEventListener("input",(e=>{R(parseFloat(e.target.value))})),J.addEventListener("change",(e=>{R(parseFloat(e.target.value))})),X.addEventListener("input",(e=>{I(parseInt(e.target.value))})),X.addEventListener("change",(e=>{I(parseInt(e.target.value))})),q.addEventListener("input",(e=>{M(parseInt(e.target.value))})),q.addEventListener("change",(e=>{M(parseInt(e.target.value))})),K.addEventListener("input",(e=>{A(e.target.value)})),K.addEventListener("change",(e=>{A(e.target.value)}));var V=n(889);const Z=l("dragdrop"),ee=l("select"),te=l("font"),ne=l("iterator"),re=l("load"),ae=l("try"),oe=l("save"),ie=l("name"),se=l("surname"),le=l("real-workspace"),ce=l("upload");re.addEventListener("click",(()=>ce.click()));const de=e=>()=>{for(const t of e)c(t,"background-color","#887880")},ge=de([Z,ee,ne,re,oe]);Z.addEventListener("click",(()=>{ge(),c(Z,"background-color","#8A4F7D"),c(le,"cursor","grab"),x("modality",m("Drag")),v().font_open&&Q()}));const _e=()=>{c(ee,"background-color","#8A4F7D"),c(le,"cursor","text"),d(ie,"contentEditable","true"),d(se,"contentEditable","true"),x("modality",m("Select"))};ee.addEventListener("click",(()=>{ge(),_e()})),te.addEventListener("click",(()=>{console.log(v().modality,m("Drag")),v().modality===m("Drag")&&(de([Z])(),_e()),Q()})),ae.addEventListener("click",(async()=>{const e=await E.transform_template(await E.fetch_template());let t=V.YS.new(...e);t.build(),t=t.get();const n=new Blob([t],{type:"application/pdf"}),r=document.createElement("a");r.download="ticket.pdf",r.href=URL.createObjectURL(n),r.click()})),oe.addEventListener("click",(async()=>{const e=await E.get_template();delete e.image,e.font="TODO";const[t,n]=await(async e=>{let t=await fetch("save-template",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",referrefPolicy:"no-referree",body:JSON.stringify(e)});const n=await t.text();return[t.status,n]})(e);199<t<300?alert("template uploaded"):alert("some error occurred")}));const he=l("upload"),me=l("image"),ue=l("message"),fe=l("load-image"),we=l("use-test-image"),pe=l("label"),ye=l("loading"),be=async e=>{let t=await fetch("upload-photo",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain"},redirect:"follow",referrefPolicy:"no-referree",body:e});const n=await t.text();return[t.status,n]},xe=async(e,t)=>{const n=document.createElement("canvas"),r=n.getContext("2d"),a=new FileReader,o=new Promise((o=>{a.addEventListener("load",(e=>{const a=new Image;a.onload=()=>{n.width=a.width,n.height=a.height,r.drawImage(a,0,0),n.toBlob((e=>o(e)),"image/jpeg",t)},a.src=e.target.result})),a.readAsDataURL(e)}));return await o},ve=e=>{d(me,"src",`photo-archive/${e}.jpeg`),c(ye,"display","none"),c(me,"display","block"),c(pe,"display","flex")};he.addEventListener("change",(async()=>{const e=he.files;c(ue,"display","none"),c(fe,"display","none"),c(we,"display","none"),c(ye,"display","block");for(const t of e){let[e,n]=await be(await xe(t,.45));e&&n&&ve(n)}})),fe.addEventListener("click",(()=>load.click())),we.addEventListener("click",(()=>(c(ue,"display","none"),c(fe,"display","none"),c(we,"display","none"),c(ye,"display","block"),x("is_test_image",!0),void ve("test-image"))));const ke=l("password"),Ee=l("password-button"),Le=l("login-background");if(Ee.addEventListener("click",(()=>{(async e=>{let[t,n]=await(async e=>{let t=await fetch("login",{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",referrefPolicy:"no-referree",body:JSON.stringify({password:e})});const n=await t.text();return[t.status,n]})(e);202==t&&n&&(x("logged",!0),c(Le,"display","none"))})(ke.value)})),"localhost"===location.hostname||"127.0.0.1"===location.hostname){const e=h.concat(r).concat(f);for(const t of e)t()}y.draw(),window.addEventListener("resize",y.draw)},889:(e,t,n)=>{"use strict";n.d(t,{YS:()=>x,ug:()=>v,m_:()=>k,Ch:()=>E,l6:()=>L,iH:()=>O,KY:()=>D,fW:()=>C,cM:()=>T,HF:()=>S,fY:()=>z,Or:()=>B});var r=n(162);e=n.hmd(e);const a=new Array(32).fill(void 0);function o(e){return a[e]}a.push(void 0,null,!0,!1);let i=a.length;function s(e){i===a.length&&a.push(a.length+1);const t=i;return i=a[t],a[t]=e,t}function l(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return""+e;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let n="[";t>0&&(n+=l(e[0]));for(let r=1;r<t;r++)n+=", "+l(e[r]);return n+="]",n}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(!(n.length>1))return toString.call(e);if(r=n[1],"Object"==r)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:r}let c=0,d=null;function g(){return null!==d&&d.buffer===r.memory.buffer||(d=new Uint8Array(r.memory.buffer)),d}let _=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const h="function"==typeof _.encodeInto?function(e,t){return _.encodeInto(e,t)}:function(e,t){const n=_.encode(e);return t.set(n),{read:e.length,written:n.length}};function m(e,t,n){if(void 0===n){const n=_.encode(e),r=t(n.length);return g().subarray(r,r+n.length).set(n),c=n.length,r}let r=e.length,a=t(r);const o=g();let i=0;for(;i<r;i++){const t=e.charCodeAt(i);if(t>127)break;o[a+i]=t}if(i!==r){0!==i&&(e=e.slice(i)),a=n(a,r,r=i+3*e.length);const t=g().subarray(a+i,a+r);i+=h(e,t).written}return c=i,a}let u=null;function f(){return null!==u&&u.buffer===r.memory.buffer||(u=new Int32Array(r.memory.buffer)),u}let w=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function p(e,t){const n=t(1*e.length);return g().set(e,n/1),c=e.length,n}w.decode();const y=new Uint32Array(2),b=new BigInt64Array(y.buffer);class x{static __wrap(e){const t=Object.create(x.prototype);return t.ptr=e,t}free(){const e=this.ptr;this.ptr=0,r.__wbg_template_free(e)}build(){r.template_build(this.ptr)}get(){try{var e=this.ptr;this.ptr=0;const o=r.__wbindgen_export_2.value-16;r.__wbindgen_export_2.value=o,r.template_get(o,e);var t=f()[o/4+0],n=f()[o/4+1],a=function(e,t){return g().subarray(e/1,e/1+t)}(t,n).slice();return r.__wbindgen_free(t,1*n),a}finally{r.__wbindgen_export_2.value+=16}}static new(e,t,n,a,o,i,s,l,d,g,_,h,u,f,w){var v=p(e,r.__wbindgen_malloc),k=c,E=m(s,r.__wbindgen_malloc,r.__wbindgen_realloc),L=c,O=p(l,r.__wbindgen_malloc),D=c;b[0]=d;const C=y[0],T=y[1];var S=m(g,r.__wbindgen_malloc,r.__wbindgen_realloc),z=c,B=m(_,r.__wbindgen_malloc,r.__wbindgen_realloc),j=c,R=r.template_new(v,k,t,n,a,o,i,E,L,O,D,C,T,S,z,B,j,h,u,f,w);return x.__wrap(R)}}const v=function(e){!function(e){const t=o(e);(function(e){e<36||(a[e]=i,i=e)})(e)}(e)},k=function(e){return s(o(e))},E=function(e){return o(e).getDate()},L=function(e){return o(e).getFullYear()},O=function(e){return o(e).getHours()},D=function(e){return o(e).getMinutes()},C=function(e){return o(e).getMonth()},T=function(e){return o(e).getSeconds()},S=function(){return s(new Date)},z=function(e,t){var n=m(l(o(t)),r.__wbindgen_malloc,r.__wbindgen_realloc),a=c;f()[e/4+1]=a,f()[e/4+0]=n},B=function(e,t){throw new Error((n=e,r=t,w.decode(g().subarray(n,n+r))));var n,r}},162:(e,t,n)=>{"use strict";var r=n.w[e.id];e.exports=r,n(889),r[""]()}}]);